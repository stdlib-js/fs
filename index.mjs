// Copyright (c) 2024 The Stdlib Authors. License is Apache-2.0: http://www.apache.org/licenses/LICENSE-2.0
/// <reference types="./index.d.ts" />
import e from"https://cdn.jsdelivr.net/gh/stdlib-js/utils-define-read-only-property@v0.1.1-esm/index.mjs";import r from"https://cdn.jsdelivr.net/gh/stdlib-js/utils-define-nonenumerable-read-only-property@v0.1.0-esm/index.mjs";import{isPrimitive as n}from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-nonnegative-integer@v0.1.0-esm/index.mjs";import t from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-function@v0.1.1-esm/index.mjs";import i from"https://cdn.jsdelivr.net/gh/stdlib-js/string-format@v0.1.1-esm/index.mjs";import{primitives as s}from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-string-array@v0.1.1-esm/index.mjs";import a from"https://cdn.jsdelivr.net/gh/stdlib-js/object-assign@v0.1.0-esm/index.mjs";import o from"https://cdn.jsdelivr.net/gh/stdlib-js/math-base-special-pow@esm/index.mjs";import l from"https://cdn.jsdelivr.net/gh/stdlib-js/utils-keys@esm/index.mjs";import{isPrimitive as u}from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-string@v0.1.1-esm/index.mjs";import d from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-plain-object@v0.1.0-esm/index.mjs";import f from"https://cdn.jsdelivr.net/gh/stdlib-js/string-remove-utf8-bom@v0.1.1-esm/index.mjs";import c from"https://cdn.jsdelivr.net/gh/stdlib-js/utils-parse-json@v0.1.1-esm/index.mjs";import m from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-instance-of@v0.1.1-esm/index.mjs";import v from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-plain-object@esm/index.mjs";import g from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-uint8array@v0.1.1-esm/index.mjs";import p from"https://cdn.jsdelivr.net/gh/stdlib-js/array-uint8@v0.1.1-esm/index.mjs";import h from"https://cdn.jsdelivr.net/gh/stdlib-js/array-uint8@esm/index.mjs";import y from"https://cdn.jsdelivr.net/gh/stdlib-js/string-format@esm/index.mjs";import j from"https://cdn.jsdelivr.net/gh/stdlib-js/process-cwd@esm/index.mjs";import b from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-has-own-property@esm/index.mjs";import{isPrimitive as w}from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-string@esm/index.mjs";import E from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-function@esm/index.mjs";function x(e){if(e.__esModule)return e;var r=e.default;if("function"==typeof r){var n=function e(){if(this instanceof e){var n=[null];n.push.apply(n,arguments);var t=Function.bind.apply(r,n);return new t}return r.apply(this,arguments)};n.prototype=r.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(e).forEach((function(r){var t=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(n,r,t.get?t:{enumerable:!0,get:function(){return e[r]}})})),n}var T=x(Object.freeze({__proto__:null,default:{}})),V=T.close;function F(e,r){if(!n(e))throw new TypeError(i("invalid argument. First argument must be a valid file descriptor (i.e., nonnegative integer). Value: `%s`.",e));if(!t(r))throw new TypeError(i("invalid argument. Last argument must be a function. Value: `%s`.",r));V(e,r)}var S=T.closeSync;r(F,"sync",(function(e){if(!n(e))throw new TypeError(i("invalid argument. Must provide a valid file descriptor (i.e., a nonnegative integer). Value: `%s`.",e));try{S(e)}catch(e){return e}}));var O,_=T;function P(e,r){O(e,(function(e){if(2===r.length)return e?r(e,!1):r(null,!0);if(e)return r(!1);return r(!0)}))}O="function"==typeof _.access?_.access:_.stat;var k,A=T;function M(e){try{k(e)}catch(e){return!1}return!0}k="function"==typeof A.accessSync?A.accessSync:A.statSync,r(P,"sync",M);var R="r",z=438,C=T.open;function L(e,r,n,t){var i=arguments.length;return 2===i?C(e,R,z,r):3===i?C(e,r,z,n):void C(e,r,n,t)}var D=T.openSync;r(L,"sync",(function(e,r,n){var t,i;t=arguments.length;try{i=1===t?D(e,R,z):D(e,r,2===t?z:n)}catch(e){return e}return i}));var B=T.readdir;function I(){var e,r;for(e=[],r=0;r<arguments.length;r++)e.push(arguments[r]);B.apply(null,e)}var N=T.readdirSync;r(I,"sync",(function(e){try{return N(e)}catch(e){return e}}));var W=T.readFile;function J(){var e,r;for(e=[],r=0;r<arguments.length;r++)e.push(arguments[r]);W.apply(null,e)}var $=T.readFileSync;function q(e,r){var n;try{n=arguments.length>1?$(e,r):$(e)}catch(e){return e}return n}r(J,"sync",q);var G=x(Object.freeze({__proto__:null,default:()=>()=>{}})),H=100,K=18e5;function Q(e,r){var n=o(2,e)-1;return n>r&&(n=r),n}var U=clearTimeout;function X(e){var r,n;for(r=l(e),n=0;n<r.length;n++)U(e[r[n]])}var Y=G("read-file-list:async"),Z=H,ee=K;function re(e,r,n){var o,l,u,d,f,c,m,v;if(!s(e))throw new TypeError(i("invalid argument. First argument must be an array of strings. Value: `%s`.",e));if(arguments.length<3?(f={},m=r):(f=a({},r),m=n),!t(m))throw new TypeError(i("invalid argument. Callback argument must be a function. Value: `%s`.",m));for(c=e.length,l=new Array(c),o={},d=0,Y("Reading %d files...",c),v=0;v<c;v++)Y("Reading file: %s (%d of %d).",e[v],v+1,c),J(e[v],f,g(v));function g(r){var n,t,i;function s(){delete o[r],Y("Reading file: %s (%d of %d). Retry: %d of %d.",t,i,c,n,Z),J(t,f,a)}function a(e,a){var f;if(!u)return e?(Y("Encountered an error when reading %s (%d of %d). Error: %s",t,i,c,e.message),"EMFILE"===e.code||"ENFILE"===e.code?(n+=1)>Z?(Y("Maximum number of retries exceeded. Too many open files."),p(e=new Error("unexpected error. Max retries exceeded. Too many open files."))):(f=Q(n,ee),Y("Too many open files. Will retry reading file %d of %d in %s seconds.",i,c,f/1e3),void(o[r]=setTimeout(s,f))):p(e)):(Y("Successfully read file: %s (%d of %d).",t,i,c),l[r]={file:t,data:a},Y("Read %d of %d files.",d+=1,c),d===c?p():void 0);Y("An error has already been returned. Discarding data for file: %s (%d of %d).",t,i,c)}return t=e[r],i=r+1,n=0,a}function p(e){if(X(o),e)return u=!0,m(e);Y("Successfully read all files."),m(null,l)}}var ne=G("read-file-list:sync");function te(e,r,n){var s,a;if(arguments.length<3)s={},a=r;else{if(u(r))s={encoding:r};else{if(!d(r))throw new TypeError(i("invalid argument. Options argument must be either a string or an object. Value: `%s`.",r));s=r}a=n}if(!t(a))throw new TypeError(i("invalid argument. Callback argument must be a function. Value: `%s`.",a));function o(e,r){return e?a(e):(r=r.toString(),"utf8"===s.encoding&&(r=f(r)),r=s.reviver?c(r,s.reviver):c(r),m(r,Error)?a(r):void a(null,r))}J(e,s,o)}function ie(e,r,n){var s,a;if(arguments.length<3)s={},a=r;else{if(!v(r))throw new TypeError(i("invalid argument. Options argument must be an object. Value: `%s`.",r));s=r,a=n}if(!t(a))throw new TypeError(i("invalid argument. Callback argument must be a function. Value: `%s`.",a));function o(e,r){var n,t;if(e)return a(e);if(g(r))return a(null,r);for(n=new p(r.length),t=0;t<r.length;t++)n[t]=r[t];a(null,n)}s.encoding=null,J(e,s,o)}r(re,"sync",(function(e,r){var n,t,a,o,l;if(!s(e))throw new TypeError(i("invalid argument. First argument must be an array of strings. Value: `%s`.",e));for(t=arguments.length>1?r:{},o=e.length,n=new Array(o),ne("Reading %d files...",o),l=0;l<o;l++){if(ne("Reading file: %s (%d of %d).",e[l],l+1,o),(a=q(e[l],t))instanceof Error)return ne("Encountered an error when reading file: %s (%d of %d). Error: %s",e[l],l,o,a.message),a;ne("Successfully read file: %s (%d of %d).",e[l],l,o),n[l]={file:e[l],data:a}}return ne("Finished reading files."),n})),r(te,"sync",(function(e,r){var n,t;if(arguments.length>1)if(u(r))n={encoding:r};else{if(!d(r))throw new TypeError(i("invalid argument. Options argument must be either a string or an object. Value: `%s`.",r));n=r}else n={};return t=q(e,n),m(t,Error)?t:(t=t.toString(),"utf8"===n.encoding&&(t=f(t)),n.reviver?c(t,n.reviver):c(t))})),r(ie,"sync",(function(e,r){var n,t,i,s;if(arguments.length>1){if(!d(r))throw new TypeError(y("invalid argument. Options argument must be an object. Value: `%s`.",r));n=r}else n={};if(n.encoding=null,i=q(e,n),m(i,Error))return i;if(g(i))return i;for(t=new h(i.length),s=0;s<i.length;s++)t[s]=i[s];return t}));var se=T.rename;function ae(e,r,n){se(e,r,n)}var oe=T.renameSync;function le(e,r){for(var n=0,t=e.length-1;t>=0;t--){var i=e[t];"."===i?e.splice(t,1):".."===i?(e.splice(t,1),n++):n&&(e.splice(t,1),n--)}if(r)for(;n--;n)e.unshift("..");return e}r(ae,"sync",(function(e,r){try{oe(e,r)}catch(e){return e}return null}));var ue=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,de=function(e){return ue.exec(e).slice(1)};function fe(){for(var e="",r=!1,n=arguments.length-1;n>=-1&&!r;n--){var t=n>=0?arguments[n]:"/";if("string"!=typeof t)throw new TypeError("Arguments to path.resolve must be strings");t&&(e=t+"/"+e,r="/"===t.charAt(0))}return(r?"/":"")+(e=le(be(e.split("/"),(function(e){return!!e})),!r).join("/"))||"."}function ce(e){var r=me(e),n="/"===we(e,-1);return(e=le(be(e.split("/"),(function(e){return!!e})),!r).join("/"))||r||(e="."),e&&n&&(e+="/"),(r?"/":"")+e}function me(e){return"/"===e.charAt(0)}function ve(){var e=Array.prototype.slice.call(arguments,0);return ce(be(e,(function(e,r){if("string"!=typeof e)throw new TypeError("Arguments to path.join must be strings");return e})).join("/"))}function ge(e,r){function n(e){for(var r=0;r<e.length&&""===e[r];r++);for(var n=e.length-1;n>=0&&""===e[n];n--);return r>n?[]:e.slice(r,n-r+1)}e=fe(e).substr(1),r=fe(r).substr(1);for(var t=n(e.split("/")),i=n(r.split("/")),s=Math.min(t.length,i.length),a=s,o=0;o<s;o++)if(t[o]!==i[o]){a=o;break}var l=[];for(o=a;o<t.length;o++)l.push("..");return(l=l.concat(i.slice(a))).join("/")}function pe(e){var r=de(e),n=r[0],t=r[1];return n||t?(t&&(t=t.substr(0,t.length-1)),n+t):"."}function he(e,r){var n=de(e)[2];return r&&n.substr(-1*r.length)===r&&(n=n.substr(0,n.length-r.length)),n}function ye(e){return de(e)[3]}var je={extname:ye,basename:he,dirname:pe,sep:"/",delimiter:":",relative:ge,join:ve,isAbsolute:me,normalize:ce,resolve:fe};function be(e,r){if(e.filter)return e.filter(r);for(var n=[],t=0;t<e.length;t++)r(e[t],t,e)&&n.push(e[t]);return n}var we="b"==="ab".substr(-1)?function(e,r,n){return e.substr(r,n)}:function(e,r,n){return r<0&&(r=e.length+r),e.substr(r,n)},Ee=x(Object.freeze({__proto__:null,basename:he,default:je,delimiter:":",dirname:pe,extname:ye,isAbsolute:me,join:ve,normalize:ce,relative:ge,resolve:fe,sep:"/"}));function xe(e,r){return d(r)?b(r,"dir")&&(e.dir=r.dir,!u(e.dir))?new TypeError(i("invalid option. `%s` option must be a string. Option: `%s`.","dir",e.dir)):null:new TypeError(i("invalid argument. Options argument must be an object. Value: `%s`.",r))}var Te=Ee.resolve;function Ve(e,r,n){var s,a,o,l,d,f;if(!u(e))throw new TypeError(i("invalid argument. First argument must be a string. Value: `%s`.",e));if(o={},arguments.length>2){if(l=n,f=xe(o,r))throw f}else l=r;if(!t(l))throw new TypeError(i("invalid argument. Callback argument must be a function. Value: `%s`.",l));function c(r,n){return n?l(null,s):(a=d,d=Te(d,".."),a===d?l(null,null):void P(s=Te(d,e),c))}d=o.dir?Te(j(),o.dir):j(),P(s=Te(d,e),c)}var Fe=Ee.resolve;function Se(e,r){return d(r)?b(r,"dir")&&(e.dir=r.dir,!u(e.dir))?new TypeError(i("invalid option. `%s` option must be a string. Option: `%s`.","dir",e.dir)):null:new TypeError(i("invalid argument. Options argument must be an object. Value: `%s`.",r))}r(Ve,"sync",(function(e,r){var n,t,i,s,a;if(!w(e))throw new TypeError(y("invalid argument. First argument must be a string. Value: `%s`.",e));if(i={},arguments.length>1&&(a=xe(i,r)))throw a;for(s=i.dir?Fe(j(),i.dir):j();t!==s;){if(M(n=Fe(s,e)))return n;t=s,s=Fe(s,"..")}return null}));var Oe=Ee.resolve;function _e(e,r,n,t){var i,s,a,o,l,u,d;if(!w(e))throw new TypeError(y("invalid argument. First argument must be a string. Value: `%s`.",e));if(o={},arguments.length>3){if(d=Se(o,r))throw d;a=n,l=t}else a=r,l=n;if(!E(a))throw new TypeError(y("invalid argument. Predicate function must be a function. Value: `%s`.",a));if(!E(l))throw new TypeError(y("invalid argument. Callback argument must be a function. Value: `%s`.",l));function f(){if(s=u,u=Oe(u,".."),s===u)return l(null,null);P(i=Oe(u,e),c)}function c(e,r){if(r)return a(i,m);f()}function m(e,r){return e?l(e):r?l(null,i):void f()}u=o.dir?Oe(j(),o.dir):j(),P(i=Oe(u,e),c)}var Pe=Ee.resolve;r(_e,"sync",(function(e,r,n){var s,a,o,l,d,f;if(!u(e))throw new TypeError(i("invalid argument. First argument must be a string. Value: `%s`.",e));if(l={},arguments.length>2){if(f=Se(l,r))throw f;o=n}else o=r;if(!t(o))throw new TypeError(i("invalid argument. Last argument must be a function. Value: `%s`.",o));for(d=l.dir?Pe(j(),l.dir):j();a!==d;){if(M(s=Pe(d,e))&&o(s))return s;a=d,d=Pe(d,"..")}return null}));var ke=T.unlink;function Ae(e,r){ke(e,r)}var Me=T.unlinkSync;r(Ae,"sync",(function(e){try{Me(e)}catch(e){return e}return null}));var Re=T.writeFile;function ze(){var e,r;for(e=[],r=0;r<arguments.length;r++)e.push(arguments[r]);Re.apply(null,e)}var Ce=T.writeFileSync;r(ze,"sync",(function(e,r,n){try{arguments.length>2?Ce(e,r,n):Ce(e,r)}catch(e){return e}return null}));var Le={};e(Le,"close",F),e(Le,"exists",P),e(Le,"open",L),e(Le,"readDir",I),e(Le,"readFile",J),e(Le,"readFileList",re),e(Le,"readJSON",te),e(Le,"readWASM",ie),e(Le,"rename",ae),e(Le,"resolveParentPath",Ve),e(Le,"resolveParentPathBy",_e),e(Le,"unlink",Ae),e(Le,"writeFile",ze);export{F as close,Le as default,P as exists,L as open,I as readDir,J as readFile,re as readFileList,te as readJSON,ie as readWASM,ae as rename,Ve as resolveParentPath,_e as resolveParentPathBy,Ae as unlink,ze as writeFile};
//# sourceMappingURL=index.mjs.map
