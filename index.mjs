// Copyright (c) 2022 The Stdlib Authors. License is Apache-2.0: http://www.apache.org/licenses/LICENSE-2.0
/// <reference types="./index.d.ts" />
import e from"https://cdn.jsdelivr.net/gh/stdlib-js/utils-define-read-only-property@esm/index.mjs";import r from"https://cdn.jsdelivr.net/gh/stdlib-js/utils-define-nonenumerable-read-only-property@esm/index.mjs";import n from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-nonnegative-integer@esm/index.mjs";import t from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-function@esm/index.mjs";import i from"https://cdn.jsdelivr.net/gh/stdlib-js/string-format@esm/index.mjs";import s from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-string-array@esm/index.mjs";import o from"https://cdn.jsdelivr.net/gh/stdlib-js/utils-copy@esm/index.mjs";import a from"https://cdn.jsdelivr.net/gh/stdlib-js/math-base-special-pow@esm/index.mjs";import u from"https://cdn.jsdelivr.net/gh/stdlib-js/utils-keys@esm/index.mjs";import l from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-string@esm/index.mjs";import f from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-plain-object@esm/index.mjs";import c from"https://cdn.jsdelivr.net/gh/stdlib-js/string-remove-utf8-bom@esm/index.mjs";import d from"https://cdn.jsdelivr.net/gh/stdlib-js/utils-parse-json@esm/index.mjs";import m from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-instance-of@esm/index.mjs";import v from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-uint8array@esm/index.mjs";import g from"https://cdn.jsdelivr.net/gh/stdlib-js/array-uint8@esm/index.mjs";import h from"https://cdn.jsdelivr.net/gh/stdlib-js/process-cwd@esm/index.mjs";import p from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-has-own-property@esm/index.mjs";function y(e){if(e.__esModule)return e;var r=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(e).forEach((function(n){var t=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(r,n,t.get?t:{enumerable:!0,get:function(){return e[n]}})})),r}var w=y(Object.freeze({__proto__:null,default:{}})),b=w.close,j=n.isPrimitive,T=t,E=i;var x=function(e,r){if(!j(e))throw new TypeError(E("invalid argument. First argument must be a valid file descriptor (nonnegative integer). Value: `%s`.",e));if(!T(r))throw new TypeError(E("invalid argument. Last argument must be a function. Value: `%s`.",r));b(e,r)},P=w.closeSync,V=n.isPrimitive,F=i;var S=x;r(S,"sync",(function(e){if(!V(e))throw new TypeError(F("invalid argument. Must provide a valid file descriptor (nonnegative integer). Value: `%s`.",e));try{P(e)}catch(e){return e}}));var _,O=S,k=w;_="function"==typeof k.access?k.access:k.stat;var A,M=function(e,r){_(e,(function(e){if(2===r.length)return e?r(e,!1):r(null,!0);if(e)return r(!1);return r(!0)}))},L=w;A="function"==typeof L.accessSync?L.accessSync:L.statSync;var D=M;r(D,"sync",(function(e){try{A(e)}catch(e){return!1}return!0}));var N=D,R={flags:"r",mode:438},z=w.open,C=R;var W=function(e,r,n,t){var i=arguments.length;return 2===i?z(e,C.flags,C.mode,r):3===i?z(e,r,C.mode,n):void z(e,r,n,t)},q=w.openSync,B=R;var I=function(e,r,n){var t,i;t=arguments.length;try{i=1===t?q(e,B.flags,B.mode):q(e,r,2===t?B.mode:n)}catch(e){return e}return i},J=W;r(J,"sync",I);var $=J,G=w.readdir;var H=function(){var e,r;for(e=[],r=0;r<arguments.length;r++)e.push(arguments[r]);G.apply(null,e)},K=w.readdirSync;var Q=H;r(Q,"sync",(function(e){try{return K(e)}catch(e){return e}}));var U=Q,X=w.readFile;var Y=function(){var e,r;for(e=[],r=0;r<arguments.length;r++)e.push(arguments[r]);X.apply(null,e)},Z=w.readFileSync;var ee=Y;r(ee,"sync",(function(e,r){var n;try{n=arguments.length>1?Z(e,r):Z(e)}catch(e){return e}return n}));var re=ee,ne="undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{};function te(){throw new Error("setTimeout has not been defined")}function ie(){throw new Error("clearTimeout has not been defined")}var se=te,oe=ie;function ae(e){if(se===setTimeout)return setTimeout(e,0);if((se===te||!se)&&setTimeout)return se=setTimeout,setTimeout(e,0);try{return se(e,0)}catch(r){try{return se.call(null,e,0)}catch(r){return se.call(this,e,0)}}}"function"==typeof ne.setTimeout&&(se=setTimeout),"function"==typeof ne.clearTimeout&&(oe=clearTimeout);var ue,le=[],fe=!1,ce=-1;function de(){fe&&ue&&(fe=!1,ue.length?le=ue.concat(le):ce=-1,le.length&&me())}function me(){if(!fe){var e=ae(de);fe=!0;for(var r=le.length;r;){for(ue=le,le=[];++ce<r;)ue&&ue[ce].run();ce=-1,r=le.length}ue=null,fe=!1,function(e){if(oe===clearTimeout)return clearTimeout(e);if((oe===ie||!oe)&&clearTimeout)return oe=clearTimeout,clearTimeout(e);try{oe(e)}catch(r){try{return oe.call(null,e)}catch(r){return oe.call(this,e)}}}(e)}}function ve(e,r){this.fun=e,this.array=r}ve.prototype.run=function(){this.fun.apply(null,this.array)};function ge(){}var he=ge,pe=ge,ye=ge,we=ge,be=ge,je=ge,Te=ge;var Ee=ne.performance||{},xe=Ee.now||Ee.mozNow||Ee.msNow||Ee.oNow||Ee.webkitNow||function(){return(new Date).getTime()};var Pe=new Date;var Ve={nextTick:function(e){var r=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)r[n-1]=arguments[n];le.push(new ve(e,r)),1!==le.length||fe||ae(me)},title:"browser",browser:!0,env:{},argv:[],version:"",versions:{},on:he,addListener:pe,once:ye,off:we,removeListener:be,removeAllListeners:je,emit:Te,binding:function(e){throw new Error("process.binding is not supported")},cwd:function(){return"/"},chdir:function(e){throw new Error("process.chdir is not supported")},umask:function(){return 0},hrtime:function(e){var r=.001*xe.call(Ee),n=Math.floor(r),t=Math.floor(r%1*1e9);return e&&(n-=e[0],(t-=e[1])<0&&(n--,t+=1e9)),[n,t]},platform:"browser",release:{},config:{},uptime:function(){return(new Date-Pe)/1e3}};module.exports=void 0!==Ve&&"renderer"===Ve.type?require("./browser.js"):require("./node.js");var Fe=y(Object.freeze({__proto__:null})),Se={max_retries:100,max_delay:18e5},_e=a;var Oe=function(e,r){var n=_e(2,e)-1;return n>r&&(n=r),n},ke=clearTimeout,Ae=u,Me=ke;var Le=function(e){var r,n;for(r=Ae(e),n=0;n<r.length;n++)Me(e[r[n]])},De=Fe,Ne=s.primitives,Re=t,ze=o,Ce=re,We=i,qe=Se,Be=Oe,Ie=Le,Je=De("read-file-list:async"),$e=qe.max_retries,Ge=qe.max_delay;var He=function(e,r,n){var t,i,s,o,a,u,l,f;if(!Ne(e))throw new TypeError(We("invalid argument. First argument must be a string array. Value: `%s`.",e));if(arguments.length<3?(a={},l=r):(a=ze(r),l=n),!Re(l))throw new TypeError(We("invalid argument. Callback argument must be a function. Value: `%s`.",l));for(u=e.length,i=new Array(u),t={},o=0,Je("Reading %d files...",u),f=0;f<u;f++)Je("Reading file: %s (%d of %d).",e[f],f+1,u),Ce(e[f],a,c(f));function c(r){var n,l,f;function c(){delete t[r],Je("Reading file: %s (%d of %d). Retry: %d of %d.",l,f,u,n,$e),Ce(l,a,m)}function m(e,a){var m;if(!s)return e?(Je("Encountered an error when reading %s (%d of %d). Error: %s",l,f,u,e.message),"EMFILE"===e.code||"ENFILE"===e.code?(n+=1)>$e?(Je("Maximum number of retries exceeded. Too many open files."),d(e=new Error("max retries exceeded. Too many open files."))):(m=Be(n,Ge),Je("Too many open files. Will retry reading file %d of %d in %s seconds.",f,u,m/1e3),void(t[r]=setTimeout(c,m))):d(e)):(Je("Successfully read file: %s (%d of %d).",l,f,u),i[r]={file:l,data:a},Je("Read %d of %d files.",o+=1,u),o===u?d():void 0);Je("An error has already been returned. Discarding data for file: %s (%d of %d).",l,f,u)}return l=e[r],f=r+1,n=0,m}function d(e){if(Ie(t),e)return s=!0,l(e);Je("Successfully read all files."),l(null,i)}},Ke=Fe,Qe=re.sync,Ue=s.primitives,Xe=i,Ye=Ke("read-file-list:sync");var Ze=He;r(Ze,"sync",(function(e,r){var n,t,i,s,o;if(!Ue(e))throw new TypeError(Xe("invalid argument. First argument must be a string array. Value: `%s`.",e));for(t=arguments.length>1?r:{},s=e.length,n=new Array(s),Ye("Reading %d files...",s),o=0;o<s;o++){if(Ye("Reading file: %s (%d of %d).",e[o],o+1,s),(i=Qe(e[o],t))instanceof Error)return Ye("Encountered an error when reading file: %s (%d of %d). Error: %s",e[o],o,s,i.message),i;Ye("Successfully read file: %s (%d of %d).",e[o],o,s),n[o]={file:e[o],data:i}}return Ye("Finished reading files."),n}));var er=Ze,rr=l.isPrimitive,nr=f,tr=t,ir=re,sr=c,or=d,ar=m,ur=i;var lr=function(e,r,n){var t,i;if(arguments.length<3)t={},i=r;else{if(rr(r))t={encoding:r};else{if(!nr(r))throw new TypeError(ur("invalid argument. Options argument must be either a string or an object. Value: `%s`.",r));t=r}i=n}if(!tr(i))throw new TypeError(ur("invalid argument. Callback argument must be a function. Value: `%s`.",i));function s(e,r){return e?i(e):(r=r.toString(),"utf8"===t.encoding&&(r=sr(r)),r=t.reviver?or(r,t.reviver):or(r),ar(r,Error)?i(r):void i(null,r))}ir(e,t,s)},fr=l.isPrimitive,cr=f,dr=re.sync,mr=c,vr=d,gr=m,hr=i;var pr=lr;r(pr,"sync",(function(e,r){var n,t;if(arguments.length>1)if(fr(r))n={encoding:r};else{if(!cr(r))throw new TypeError(hr("invalid argument. Options argument must be either a string or an object. Value: `%s`.",r));n=r}else n={};return t=dr(e,n),gr(t,Error)?t:(t=t.toString(),"utf8"===n.encoding&&(t=mr(t)),n.reviver?vr(t,n.reviver):vr(t))}));var yr=pr,wr=f,br=t,jr=v,Tr=re,Er=g,xr=i;var Pr=f,Vr=v,Fr=m,Sr=re.sync,_r=g,Or=i;var kr=function(e,r,n){var t,i;if(arguments.length<3)t={},i=r;else{if(!wr(r))throw new TypeError(xr("invalid argument. Options argument must be an object. Value: `%s`.",r));t=r,i=n}if(!br(i))throw new TypeError(xr("invalid argument. Callback argument must be a function. Value: `%s`.",i));function s(e,r){var n,t;if(e)return i(e);if(jr(r))return i(null,r);for(n=new Er(r.length),t=0;t<r.length;t++)n[t]=r[t];i(null,n)}t.encoding=null,Tr(e,t,s)};r(kr,"sync",(function(e,r){var n,t,i,s;if(arguments.length>1){if(!Pr(r))throw new TypeError(Or("invalid argument. Options argument must be an object. Value: `%s`.",r));n=r}else n={};if(n.encoding=null,i=Sr(e,n),Fr(i,Error))return i;if(Vr(i))return i;for(t=new _r(i.length),s=0;s<i.length;s++)t[s]=i[s];return t}));var Ar=kr,Mr=w.rename;var Lr=function(e,r,n){Mr(e,r,n)},Dr=w.renameSync;var Nr=Lr;r(Nr,"sync",(function(e,r){try{Dr(e,r)}catch(e){return e}return null}));var Rr=Nr;function zr(e,r){for(var n=0,t=e.length-1;t>=0;t--){var i=e[t];"."===i?e.splice(t,1):".."===i?(e.splice(t,1),n++):n&&(e.splice(t,1),n--)}if(r)for(;n--;n)e.unshift("..");return e}var Cr=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,Wr=function(e){return Cr.exec(e).slice(1)};function qr(){for(var e="",r=!1,n=arguments.length-1;n>=-1&&!r;n--){var t=n>=0?arguments[n]:"/";if("string"!=typeof t)throw new TypeError("Arguments to path.resolve must be strings");t&&(e=t+"/"+e,r="/"===t.charAt(0))}return(r?"/":"")+(e=zr(Ur(e.split("/"),(function(e){return!!e})),!r).join("/"))||"."}function Br(e){var r=Ir(e),n="/"===Xr(e,-1);return(e=zr(Ur(e.split("/"),(function(e){return!!e})),!r).join("/"))||r||(e="."),e&&n&&(e+="/"),(r?"/":"")+e}function Ir(e){return"/"===e.charAt(0)}function Jr(){var e=Array.prototype.slice.call(arguments,0);return Br(Ur(e,(function(e,r){if("string"!=typeof e)throw new TypeError("Arguments to path.join must be strings");return e})).join("/"))}function $r(e,r){function n(e){for(var r=0;r<e.length&&""===e[r];r++);for(var n=e.length-1;n>=0&&""===e[n];n--);return r>n?[]:e.slice(r,n-r+1)}e=qr(e).substr(1),r=qr(r).substr(1);for(var t=n(e.split("/")),i=n(r.split("/")),s=Math.min(t.length,i.length),o=s,a=0;a<s;a++)if(t[a]!==i[a]){o=a;break}var u=[];for(a=o;a<t.length;a++)u.push("..");return(u=u.concat(i.slice(o))).join("/")}function Gr(e){var r=Wr(e),n=r[0],t=r[1];return n||t?(t&&(t=t.substr(0,t.length-1)),n+t):"."}function Hr(e,r){var n=Wr(e)[2];return r&&n.substr(-1*r.length)===r&&(n=n.substr(0,n.length-r.length)),n}function Kr(e){return Wr(e)[3]}var Qr={extname:Kr,basename:Hr,dirname:Gr,sep:"/",delimiter:":",relative:$r,join:Jr,isAbsolute:Ir,normalize:Br,resolve:qr};function Ur(e,r){if(e.filter)return e.filter(r);for(var n=[],t=0;t<e.length;t++)r(e[t],t,e)&&n.push(e[t]);return n}var Xr="b"==="ab".substr(-1)?function(e,r,n){return e.substr(r,n)}:function(e,r,n){return r<0&&(r=e.length+r),e.substr(r,n)},Yr=y(Object.freeze({__proto__:null,resolve:qr,normalize:Br,isAbsolute:Ir,join:Jr,relative:$r,sep:"/",delimiter:":",dirname:Gr,basename:Hr,extname:Kr,default:Qr})),Zr=f,en=p,rn=l.isPrimitive,nn=i;var tn=function(e,r){return Zr(r)?en(r,"dir")&&(e.dir=r.dir,!rn(e.dir))?new TypeError(nn("invalid option. `%s` option must be a string. Option: `%s`.","dir",e.dir)):null:new TypeError(nn("invalid argument. Options argument must be an object. Value: `%s`.",r))},sn=Yr.resolve,on=l.isPrimitive,an=t,un=h,ln=N,fn=i,cn=tn;var dn=function(e,r,n){var t,i,s,o,a,u;if(!on(e))throw new TypeError(fn("invalid argument. First argument must be a string. Value: `%s`.",e));if(s={},arguments.length>2){if(o=n,u=cn(s,r))throw u}else o=r;if(!an(o))throw new TypeError(fn("invalid argument. Callback argument must be a function. Value: `%s`.",o));function l(r,n){return n?o(null,t):(i=a,a=sn(a,".."),i===a?o(null,null):(t=sn(a,e),void ln(t,l)))}a=s.dir?sn(un(),s.dir):un(),t=sn(a,e),ln(t,l)},mn=Yr.resolve,vn=l.isPrimitive,gn=h,hn=N.sync,pn=i,yn=tn;var wn=dn;r(wn,"sync",(function(e,r){var n,t,i,s,o;if(!vn(e))throw new TypeError(pn("invalid argument. First argument must be a string. Value: `%s`.",e));if(i={},arguments.length>1&&(o=yn(i,r)))throw o;for(s=i.dir?mn(gn(),i.dir):gn();t!==s;){if(n=mn(s,e),hn(n))return n;t=s,s=mn(s,"..")}return null}));var bn=wn,jn=f,Tn=p,En=l.isPrimitive,xn=i;var Pn=function(e,r){return jn(r)?Tn(r,"dir")&&(e.dir=r.dir,!En(e.dir))?new TypeError(xn("invalid option. `%s` option must be a string. Option: `%s`.","dir",e.dir)):null:new TypeError(xn("invalid argument. Options argument must be an object. Value: `%s`.",r))},Vn=Yr.resolve,Fn=l.isPrimitive,Sn=t,_n=i,On=h,kn=N,An=Pn;var Mn=function(e,r,n,t){var i,s,o,a,u,l,f;if(!Fn(e))throw new TypeError(_n("invalid argument. First argument must be a string. Value: `%s`.",e));if(a={},arguments.length>3){if(f=An(a,r))throw f;o=n,u=t}else o=r,u=n;if(!Sn(o))throw new TypeError(_n("invalid argument. Predicate function argument must be a function. Value: `%s`.",o));if(!Sn(u))throw new TypeError(_n("invalid argument. Callback argument must be a function. Value: `%s`.",u));function c(){if(s=l,l=Vn(l,".."),s===l)return u(null,null);i=Vn(l,e),kn(i,d)}function d(e,r){if(r)return o(i,m);c()}function m(e,r){return e?u(e):r?u(null,i):void c()}l=a.dir?Vn(On(),a.dir):On(),i=Vn(l,e),kn(i,d)},Ln=Yr.resolve,Dn=l.isPrimitive,Nn=t,Rn=h,zn=N.sync,Cn=i,Wn=Pn;var qn=Mn;r(qn,"sync",(function(e,r,n){var t,i,s,o,a,u;if(!Dn(e))throw new TypeError(Cn("invalid argument. First argument must be a string. Value: `%s`.",e));if(o={},arguments.length>2){if(u=Wn(o,r))throw u;s=n}else s=r;if(!Nn(s))throw new TypeError(Cn("invalid argument. Last argument must be a function. Value: `%s`.",s));for(a=o.dir?Ln(Rn(),o.dir):Rn();i!==a;){if(t=Ln(a,e),zn(t)&&s(t))return t;i=a,a=Ln(a,"..")}return null}));var Bn=qn,In=w.unlink;var Jn=function(e,r){In(e,r)},$n=w.unlinkSync;var Gn=Jn;r(Gn,"sync",(function(e){try{$n(e)}catch(e){return e}return null}));var Hn=Gn,Kn=w.writeFile;var Qn=function(){var e,r;for(e=[],r=0;r<arguments.length;r++)e.push(arguments[r]);Kn.apply(null,e)},Un=w.writeFileSync;var Xn=Qn;r(Xn,"sync",(function(e,r,n){try{arguments.length>2?Un(e,r,n):Un(e,r)}catch(e){return e}return null}));var Yn=Xn,Zn=e,et={};Zn(et,"close",O),Zn(et,"exists",N),Zn(et,"open",$),Zn(et,"readDir",U),Zn(et,"readFile",re),Zn(et,"readFileList",er),Zn(et,"readJSON",yr),Zn(et,"readWASM",Ar),Zn(et,"rename",Rr),Zn(et,"resolveParentPath",bn),Zn(et,"resolveParentPathBy",Bn),Zn(et,"unlink",Hn),Zn(et,"writeFile",Yn);var rt=et;export{O as close,rt as default,N as exists,$ as open,U as readDir,re as readFile,er as readFileList,yr as readJSON,Ar as readWASM,Rr as rename,bn as resolveParentPath,Bn as resolveParentPathBy,Hn as unlink,Yn as writeFile};
//# sourceMappingURL=index.mjs.map
