// Copyright (c) 2023 The Stdlib Authors. License is Apache-2.0: http://www.apache.org/licenses/LICENSE-2.0
/// <reference types="./index.d.ts" />
import e from"https://cdn.jsdelivr.net/gh/stdlib-js/utils-define-read-only-property@v0.1.1-esm/index.mjs";import r from"https://cdn.jsdelivr.net/gh/stdlib-js/utils-define-nonenumerable-read-only-property@v0.1.0-esm/index.mjs";import{isPrimitive as n}from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-nonnegative-integer@v0.1.0-esm/index.mjs";import t from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-function@v0.1.1-esm/index.mjs";import i from"https://cdn.jsdelivr.net/gh/stdlib-js/string-format@v0.1.1-esm/index.mjs";import{primitives as s}from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-string-array@v0.1.1-esm/index.mjs";import o from"https://cdn.jsdelivr.net/gh/stdlib-js/object-assign@v0.1.0-esm/index.mjs";import a from"https://cdn.jsdelivr.net/gh/stdlib-js/math-base-special-pow@esm/index.mjs";import l from"https://cdn.jsdelivr.net/gh/stdlib-js/utils-keys@esm/index.mjs";import{isPrimitive as u}from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-string@v0.1.1-esm/index.mjs";import d from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-plain-object@v0.1.0-esm/index.mjs";import f from"https://cdn.jsdelivr.net/gh/stdlib-js/string-remove-utf8-bom@v0.1.1-esm/index.mjs";import c from"https://cdn.jsdelivr.net/gh/stdlib-js/utils-parse-json@v0.1.1-esm/index.mjs";import m from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-instance-of@v0.1.1-esm/index.mjs";import v from"https://cdn.jsdelivr.net/gh/stdlib-js/utils-parse-json@esm/index.mjs";import p from"https://cdn.jsdelivr.net/gh/stdlib-js/string-format@esm/index.mjs";import g from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-plain-object@esm/index.mjs";import h from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-function@esm/index.mjs";import j from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-uint8array@v0.1.1-esm/index.mjs";import y from"https://cdn.jsdelivr.net/gh/stdlib-js/array-uint8@v0.1.1-esm/index.mjs";import b from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-uint8array@esm/index.mjs";import w from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-instance-of@esm/index.mjs";import E from"https://cdn.jsdelivr.net/gh/stdlib-js/array-uint8@esm/index.mjs";import x from"https://cdn.jsdelivr.net/gh/stdlib-js/process-cwd@v0.1.1-esm/index.mjs";import T from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-has-own-property@esm/index.mjs";import{isPrimitive as V}from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-string@esm/index.mjs";import F from"https://cdn.jsdelivr.net/gh/stdlib-js/process-cwd@esm/index.mjs";function S(e){if(e.__esModule)return e;var r=e.default;if("function"==typeof r){var n=function e(){if(this instanceof e){var n=[null];n.push.apply(n,arguments);var t=Function.bind.apply(r,n);return new t}return r.apply(this,arguments)};n.prototype=r.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(e).forEach((function(r){var t=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(n,r,t.get?t:{enumerable:!0,get:function(){return e[r]}})})),n}var O=S(Object.freeze({__proto__:null,default:{}})),_=O.close;function P(e,r){if(!n(e))throw new TypeError(i("invalid argument. First argument must be a valid file descriptor (i.e., nonnegative integer). Value: `%s`.",e));if(!t(r))throw new TypeError(i("invalid argument. Last argument must be a function. Value: `%s`.",r));_(e,r)}var k=O.closeSync;r(P,"sync",(function(e){if(!n(e))throw new TypeError(i("invalid argument. Must provide a valid file descriptor (i.e., a nonnegative integer). Value: `%s`.",e));try{k(e)}catch(e){return e}}));var A,M=O;function R(e,r){A(e,(function(e){if(2===r.length)return e?r(e,!1):r(null,!0);if(e)return r(!1);return r(!0)}))}A="function"==typeof M.access?M.access:M.stat;var z,C=O;function L(e){try{z(e)}catch(e){return!1}return!0}z="function"==typeof C.accessSync?C.accessSync:C.statSync,r(R,"sync",L);var D="r",B=438,I=O.open;function N(e,r,n,t){var i=arguments.length;return 2===i?I(e,D,B,r):3===i?I(e,r,B,n):void I(e,r,n,t)}var W=O.openSync;r(N,"sync",(function(e,r,n){var t,i;t=arguments.length;try{i=1===t?W(e,D,B):W(e,r,2===t?B:n)}catch(e){return e}return i}));var J=O.readdir;function $(){var e,r;for(e=[],r=0;r<arguments.length;r++)e.push(arguments[r]);J.apply(null,e)}var q=O.readdirSync;r($,"sync",(function(e){try{return q(e)}catch(e){return e}}));var G=O.readFile;function H(){var e,r;for(e=[],r=0;r<arguments.length;r++)e.push(arguments[r]);G.apply(null,e)}var K=O.readFileSync;function Q(e,r){var n;try{n=arguments.length>1?K(e,r):K(e)}catch(e){return e}return n}r(H,"sync",Q);var U=S(Object.freeze({__proto__:null,default:()=>()=>{}})),X=100,Y=18e5;function Z(e,r){var n=a(2,e)-1;return n>r&&(n=r),n}var ee=clearTimeout;function re(e){var r,n;for(r=l(e),n=0;n<r.length;n++)ee(e[r[n]])}var ne=U("read-file-list:async"),te=X,ie=Y;function se(e,r,n){var a,l,u,d,f,c,m,v;if(!s(e))throw new TypeError(i("invalid argument. First argument must be an array of strings. Value: `%s`.",e));if(arguments.length<3?(f={},m=r):(f=o({},r),m=n),!t(m))throw new TypeError(i("invalid argument. Callback argument must be a function. Value: `%s`.",m));for(c=e.length,l=new Array(c),a={},d=0,ne("Reading %d files...",c),v=0;v<c;v++)ne("Reading file: %s (%d of %d).",e[v],v+1,c),H(e[v],f,p(v));function p(r){var n,t,i;function s(){delete a[r],ne("Reading file: %s (%d of %d). Retry: %d of %d.",t,i,c,n,te),H(t,f,o)}function o(e,o){var f;if(!u)return e?(ne("Encountered an error when reading %s (%d of %d). Error: %s",t,i,c,e.message),"EMFILE"===e.code||"ENFILE"===e.code?(n+=1)>te?(ne("Maximum number of retries exceeded. Too many open files."),g(e=new Error("unexpected error. Max retries exceeded. Too many open files."))):(f=Z(n,ie),ne("Too many open files. Will retry reading file %d of %d in %s seconds.",i,c,f/1e3),void(a[r]=setTimeout(s,f))):g(e)):(ne("Successfully read file: %s (%d of %d).",t,i,c),l[r]={file:t,data:o},ne("Read %d of %d files.",d+=1,c),d===c?g():void 0);ne("An error has already been returned. Discarding data for file: %s (%d of %d).",t,i,c)}return t=e[r],i=r+1,n=0,o}function g(e){if(re(a),e)return u=!0,m(e);ne("Successfully read all files."),m(null,l)}}var oe=U("read-file-list:sync");function ae(e,r,n){var s,o;if(arguments.length<3)s={},o=r;else{if(u(r))s={encoding:r};else{if(!d(r))throw new TypeError(i("invalid argument. Options argument must be either a string or an object. Value: `%s`.",r));s=r}o=n}if(!t(o))throw new TypeError(i("invalid argument. Callback argument must be a function. Value: `%s`.",o));function a(e,r){return e?o(e):(r=r.toString(),"utf8"===s.encoding&&(r=f(r)),r=s.reviver?c(r,s.reviver):c(r),m(r,Error)?o(r):void o(null,r))}H(e,s,a)}function le(e,r,n){var t,s;if(arguments.length<3)t={},s=r;else{if(!g(r))throw new TypeError(i("invalid argument. Options argument must be an object. Value: `%s`.",r));t=r,s=n}if(!h(s))throw new TypeError(i("invalid argument. Callback argument must be a function. Value: `%s`.",s));function o(e,r){var n,t;if(e)return s(e);if(j(r))return s(null,r);for(n=new y(r.length),t=0;t<r.length;t++)n[t]=r[t];s(null,n)}t.encoding=null,H(e,t,o)}r(se,"sync",(function(e,r){var n,t,o,a,l;if(!s(e))throw new TypeError(i("invalid argument. First argument must be an array of strings. Value: `%s`.",e));for(t=arguments.length>1?r:{},a=e.length,n=new Array(a),oe("Reading %d files...",a),l=0;l<a;l++){if(oe("Reading file: %s (%d of %d).",e[l],l+1,a),(o=Q(e[l],t))instanceof Error)return oe("Encountered an error when reading file: %s (%d of %d). Error: %s",e[l],l,a,o.message),o;oe("Successfully read file: %s (%d of %d).",e[l],l,a),n[l]={file:e[l],data:o}}return oe("Finished reading files."),n})),r(ae,"sync",(function(e,r){var n,t;if(arguments.length>1)if(u(r))n={encoding:r};else{if(!d(r))throw new TypeError(p("invalid argument. Options argument must be either a string or an object. Value: `%s`.",r));n=r}else n={};return t=Q(e,n),m(t,Error)?t:(t=t.toString(),"utf8"===n.encoding&&(t=f(t)),n.reviver?v(t,n.reviver):v(t))})),r(le,"sync",(function(e,r){var n,t,i,s;if(arguments.length>1){if(!g(r))throw new TypeError(p("invalid argument. Options argument must be an object. Value: `%s`.",r));n=r}else n={};if(n.encoding=null,i=Q(e,n),w(i,Error))return i;if(b(i))return i;for(t=new E(i.length),s=0;s<i.length;s++)t[s]=i[s];return t}));var ue=O.rename;function de(e,r,n){ue(e,r,n)}var fe=O.renameSync;function ce(e,r){for(var n=0,t=e.length-1;t>=0;t--){var i=e[t];"."===i?e.splice(t,1):".."===i?(e.splice(t,1),n++):n&&(e.splice(t,1),n--)}if(r)for(;n--;n)e.unshift("..");return e}r(de,"sync",(function(e,r){try{fe(e,r)}catch(e){return e}return null}));var me=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,ve=function(e){return me.exec(e).slice(1)};function pe(){for(var e="",r=!1,n=arguments.length-1;n>=-1&&!r;n--){var t=n>=0?arguments[n]:"/";if("string"!=typeof t)throw new TypeError("Arguments to path.resolve must be strings");t&&(e=t+"/"+e,r="/"===t.charAt(0))}return(r?"/":"")+(e=ce(Te(e.split("/"),(function(e){return!!e})),!r).join("/"))||"."}function ge(e){var r=he(e),n="/"===Ve(e,-1);return(e=ce(Te(e.split("/"),(function(e){return!!e})),!r).join("/"))||r||(e="."),e&&n&&(e+="/"),(r?"/":"")+e}function he(e){return"/"===e.charAt(0)}function je(){var e=Array.prototype.slice.call(arguments,0);return ge(Te(e,(function(e,r){if("string"!=typeof e)throw new TypeError("Arguments to path.join must be strings");return e})).join("/"))}function ye(e,r){function n(e){for(var r=0;r<e.length&&""===e[r];r++);for(var n=e.length-1;n>=0&&""===e[n];n--);return r>n?[]:e.slice(r,n-r+1)}e=pe(e).substr(1),r=pe(r).substr(1);for(var t=n(e.split("/")),i=n(r.split("/")),s=Math.min(t.length,i.length),o=s,a=0;a<s;a++)if(t[a]!==i[a]){o=a;break}var l=[];for(a=o;a<t.length;a++)l.push("..");return(l=l.concat(i.slice(o))).join("/")}function be(e){var r=ve(e),n=r[0],t=r[1];return n||t?(t&&(t=t.substr(0,t.length-1)),n+t):"."}function we(e,r){var n=ve(e)[2];return r&&n.substr(-1*r.length)===r&&(n=n.substr(0,n.length-r.length)),n}function Ee(e){return ve(e)[3]}var xe={extname:Ee,basename:we,dirname:be,sep:"/",delimiter:":",relative:ye,join:je,isAbsolute:he,normalize:ge,resolve:pe};function Te(e,r){if(e.filter)return e.filter(r);for(var n=[],t=0;t<e.length;t++)r(e[t],t,e)&&n.push(e[t]);return n}var Ve="b"==="ab".substr(-1)?function(e,r,n){return e.substr(r,n)}:function(e,r,n){return r<0&&(r=e.length+r),e.substr(r,n)},Fe=S(Object.freeze({__proto__:null,basename:we,default:xe,delimiter:":",dirname:be,extname:Ee,isAbsolute:he,join:je,normalize:ge,relative:ye,resolve:pe,sep:"/"}));function Se(e,r){return d(r)?T(r,"dir")&&(e.dir=r.dir,!V(e.dir))?new TypeError(i("invalid option. `%s` option must be a string. Option: `%s`.","dir",e.dir)):null:new TypeError(i("invalid argument. Options argument must be an object. Value: `%s`.",r))}var Oe=Fe.resolve;function _e(e,r,n){var t,s,o,a,l,d;if(!u(e))throw new TypeError(i("invalid argument. First argument must be a string. Value: `%s`.",e));if(o={},arguments.length>2){if(a=n,d=Se(o,r))throw d}else a=r;if(!h(a))throw new TypeError(i("invalid argument. Callback argument must be a function. Value: `%s`.",a));function f(r,n){return n?a(null,t):(s=l,l=Oe(l,".."),s===l?a(null,null):void R(t=Oe(l,e),f))}l=o.dir?Oe(x(),o.dir):x(),R(t=Oe(l,e),f)}var Pe=Fe.resolve;function ke(e,r){return d(r)?T(r,"dir")&&(e.dir=r.dir,!u(e.dir))?new TypeError(i("invalid option. `%s` option must be a string. Option: `%s`.","dir",e.dir)):null:new TypeError(i("invalid argument. Options argument must be an object. Value: `%s`.",r))}r(_e,"sync",(function(e,r){var n,t,i,s,o;if(!u(e))throw new TypeError(p("invalid argument. First argument must be a string. Value: `%s`.",e));if(i={},arguments.length>1&&(o=Se(i,r)))throw o;for(s=i.dir?Pe(x(),i.dir):x();t!==s;){if(L(n=Pe(s,e)))return n;t=s,s=Pe(s,"..")}return null}));var Ae=Fe.resolve;function Me(e,r,n,t){var i,s,o,a,l,u,d;if(!V(e))throw new TypeError(p("invalid argument. First argument must be a string. Value: `%s`.",e));if(a={},arguments.length>3){if(d=ke(a,r))throw d;o=n,l=t}else o=r,l=n;if(!h(o))throw new TypeError(p("invalid argument. Predicate function must be a function. Value: `%s`.",o));if(!h(l))throw new TypeError(p("invalid argument. Callback argument must be a function. Value: `%s`.",l));function f(){if(s=u,u=Ae(u,".."),s===u)return l(null,null);R(i=Ae(u,e),c)}function c(e,r){if(r)return o(i,m);f()}function m(e,r){return e?l(e):r?l(null,i):void f()}u=a.dir?Ae(F(),a.dir):F(),R(i=Ae(u,e),c)}var Re=Fe.resolve;r(Me,"sync",(function(e,r,n){var t,i,s,o,a,l;if(!V(e))throw new TypeError(p("invalid argument. First argument must be a string. Value: `%s`.",e));if(o={},arguments.length>2){if(l=ke(o,r))throw l;s=n}else s=r;if(!h(s))throw new TypeError(p("invalid argument. Last argument must be a function. Value: `%s`.",s));for(a=o.dir?Re(F(),o.dir):F();i!==a;){if(L(t=Re(a,e))&&s(t))return t;i=a,a=Re(a,"..")}return null}));var ze=O.unlink;function Ce(e,r){ze(e,r)}var Le=O.unlinkSync;r(Ce,"sync",(function(e){try{Le(e)}catch(e){return e}return null}));var De=O.writeFile;function Be(){var e,r;for(e=[],r=0;r<arguments.length;r++)e.push(arguments[r]);De.apply(null,e)}var Ie=O.writeFileSync;r(Be,"sync",(function(e,r,n){try{arguments.length>2?Ie(e,r,n):Ie(e,r)}catch(e){return e}return null}));var Ne={};e(Ne,"close",P),e(Ne,"exists",R),e(Ne,"open",N),e(Ne,"readDir",$),e(Ne,"readFile",H),e(Ne,"readFileList",se),e(Ne,"readJSON",ae),e(Ne,"readWASM",le),e(Ne,"rename",de),e(Ne,"resolveParentPath",_e),e(Ne,"resolveParentPathBy",Me),e(Ne,"unlink",Ce),e(Ne,"writeFile",Be);export{P as close,Ne as default,R as exists,N as open,$ as readDir,H as readFile,se as readFileList,ae as readJSON,le as readWASM,de as rename,_e as resolveParentPath,Me as resolveParentPathBy,Ce as unlink,Be as writeFile};
//# sourceMappingURL=index.mjs.map
