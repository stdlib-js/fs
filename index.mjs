// Copyright (c) 2024 The Stdlib Authors. License is Apache-2.0: http://www.apache.org/licenses/LICENSE-2.0
/// <reference types="./index.d.ts" />
import e from"https://cdn.jsdelivr.net/gh/stdlib-js/utils-define-read-only-property@v0.2.1-esm/index.mjs";import r from"https://cdn.jsdelivr.net/gh/stdlib-js/utils-define-nonenumerable-read-only-property@v0.2.1-esm/index.mjs";import{isPrimitive as n}from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-nonnegative-integer@v0.2.1-esm/index.mjs";import t from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-function@v0.2.1-esm/index.mjs";import i from"https://cdn.jsdelivr.net/gh/stdlib-js/string-format@v0.2.1-esm/index.mjs";import{primitives as s}from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-string-array@v0.2.1-esm/index.mjs";import o from"https://cdn.jsdelivr.net/gh/stdlib-js/object-assign@v0.2.1-esm/index.mjs";import a from"https://cdn.jsdelivr.net/gh/stdlib-js/math-base-special-pow@esm/index.mjs";import u from"https://cdn.jsdelivr.net/gh/stdlib-js/utils-keys@esm/index.mjs";import{isPrimitive as l}from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-string@v0.2.1-esm/index.mjs";import f from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-plain-object@v0.2.1-esm/index.mjs";import d from"https://cdn.jsdelivr.net/gh/stdlib-js/string-remove-utf8-bom@v0.2.1-esm/index.mjs";import c from"https://cdn.jsdelivr.net/gh/stdlib-js/utils-parse-json@v0.2.1-esm/index.mjs";import m from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-instance-of@v0.2.1-esm/index.mjs";import v from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-uint8array@v0.2.1-esm/index.mjs";import g from"https://cdn.jsdelivr.net/gh/stdlib-js/array-uint8@v0.2.1-esm/index.mjs";import p from"https://cdn.jsdelivr.net/gh/stdlib-js/process-cwd@v0.2.1-esm/index.mjs";import h from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-has-own-property@esm/index.mjs";import y from"https://cdn.jsdelivr.net/gh/stdlib-js/process-cwd@esm/index.mjs";function b(e){if(e.__esModule)return e;var r=e.default;if("function"==typeof r){var n=function e(){return this instanceof e?Reflect.construct(r,arguments,this.constructor):r.apply(this,arguments)};n.prototype=r.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(e).forEach((function(r){var t=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(n,r,t.get?t:{enumerable:!0,get:function(){return e[r]}})})),n}var j=b(Object.freeze({__proto__:null,default:{}})),w=j.close;function E(e,r){if(!n(e))throw new TypeError(i("invalid argument. First argument must be a valid file descriptor (i.e., nonnegative integer). Value: `%s`.",e));if(!t(r))throw new TypeError(i("invalid argument. Last argument must be a function. Value: `%s`.",r));w(e,r)}var T=j.closeSync;r(E,"sync",(function(e){if(!n(e))throw new TypeError(i("invalid argument. Must provide a valid file descriptor (i.e., a nonnegative integer). Value: `%s`.",e));try{T(e)}catch(e){return e}}));var x,V=j;function F(e,r){x(e,(function(e){if(2===r.length)return e?r(e,!1):r(null,!0);if(e)return r(!1);return r(!0)}))}x="function"==typeof V.access?V.access:V.stat;var S,O=j;function _(e){try{S(e)}catch(e){return!1}return!0}S="function"==typeof O.accessSync?O.accessSync:O.statSync,r(F,"sync",_);var P="r",k=438,A=j.open;function M(e,r,n,t){var i=arguments.length;return 2===i?A(e,P,k,r):3===i?A(e,r,k,n):void A(e,r,n,t)}var R=j.openSync;r(M,"sync",(function(e,r,n){var t,i;t=arguments.length;try{i=1===t?R(e,P,k):R(e,r,2===t?k:n)}catch(e){return e}return i}));var z=j.readdir;function C(){var e,r;for(e=[],r=0;r<arguments.length;r++)e.push(arguments[r]);z.apply(null,e)}var L=j.readdirSync;r(C,"sync",(function(e){try{return L(e)}catch(e){return e}}));var D=j.readFile;function B(){var e,r;for(e=[],r=0;r<arguments.length;r++)e.push(arguments[r]);D.apply(null,e)}var I=j.readFileSync;function N(e,r){var n;try{n=arguments.length>1?I(e,r):I(e)}catch(e){return e}return n}r(B,"sync",N);var W=b(Object.freeze({__proto__:null,default:()=>()=>{}})),J=100,$=18e5;var q=clearTimeout;var G=W("read-file-list:async"),H=J,K=$;function Q(e,r,n){var l,f,d,c,m,v,g,p;if(!s(e))throw new TypeError(i("invalid argument. First argument must be an array of strings. Value: `%s`.",e));if(arguments.length<3?(m={},g=r):(m=o({},r),g=n),!t(g))throw new TypeError(i("invalid argument. Callback argument must be a function. Value: `%s`.",g));for(v=e.length,f=new Array(v),l={},c=0,G("Reading %d files...",v),p=0;p<v;p++)G("Reading file: %s (%d of %d).",e[p],p+1,v),B(e[p],m,h(p));function h(r){var n,t,i;function s(){delete l[r],G("Reading file: %s (%d of %d). Retry: %d of %d.",t,i,v,n,H),B(t,m,o)}function o(e,o){var u;if(!d)return e?(G("Encountered an error when reading %s (%d of %d). Error: %s",t,i,v,e.message),"EMFILE"===e.code||"ENFILE"===e.code?(n+=1)>H?(G("Maximum number of retries exceeded. Too many open files."),y(e=new Error("unexpected error. Max retries exceeded. Too many open files."))):(u=function(e,r){var n=a(2,e)-1;return n>r&&(n=r),n}(n,K),G("Too many open files. Will retry reading file %d of %d in %s seconds.",i,v,u/1e3),void(l[r]=setTimeout(s,u))):y(e)):(G("Successfully read file: %s (%d of %d).",t,i,v),f[r]={file:t,data:o},G("Read %d of %d files.",c+=1,v),c===v?y():void 0);G("An error has already been returned. Discarding data for file: %s (%d of %d).",t,i,v)}return t=e[r],i=r+1,n=0,o}function y(e){if(function(e){var r,n;for(r=u(e),n=0;n<r.length;n++)q(e[r[n]])}(l),e)return d=!0,g(e);G("Successfully read all files."),g(null,f)}}var U=W("read-file-list:sync");function X(e,r,n){var s,o;if(arguments.length<3)s={},o=r;else{if(l(r))s={encoding:r};else{if(!f(r))throw new TypeError(i("invalid argument. Options argument must be either a string or an object. Value: `%s`.",r));s=r}o=n}if(!t(o))throw new TypeError(i("invalid argument. Callback argument must be a function. Value: `%s`.",o));B(e,s,(function(e,r){if(e)return o(e);r=r.toString(),"utf8"===s.encoding&&(r=d(r));r=s.reviver?c(r,s.reviver):c(r);if(m(r,Error))return o(r);o(null,r)}))}function Y(e,r,n){var s,o;if(arguments.length<3)s={},o=r;else{if(!f(r))throw new TypeError(i("invalid argument. Options argument must be an object. Value: `%s`.",r));s=r,o=n}if(!t(o))throw new TypeError(i("invalid argument. Callback argument must be a function. Value: `%s`.",o));s.encoding=null,B(e,s,(function(e,r){var n,t;if(e)return o(e);if(v(r))return o(null,r);for(n=new g(r.length),t=0;t<r.length;t++)n[t]=r[t];o(null,n)}))}r(Q,"sync",(function(e,r){var n,t,o,a,u;if(!s(e))throw new TypeError(i("invalid argument. First argument must be an array of strings. Value: `%s`.",e));for(t=arguments.length>1?r:{},a=e.length,n=new Array(a),U("Reading %d files...",a),u=0;u<a;u++){if(U("Reading file: %s (%d of %d).",e[u],u+1,a),(o=N(e[u],t))instanceof Error)return U("Encountered an error when reading file: %s (%d of %d). Error: %s",e[u],u,a,o.message),o;U("Successfully read file: %s (%d of %d).",e[u],u,a),n[u]={file:e[u],data:o}}return U("Finished reading files."),n})),r(X,"sync",(function(e,r){var n,t;if(arguments.length>1)if(l(r))n={encoding:r};else{if(!f(r))throw new TypeError(i("invalid argument. Options argument must be either a string or an object. Value: `%s`.",r));n=r}else n={};return t=N(e,n),m(t,Error)?t:(t=t.toString(),"utf8"===n.encoding&&(t=d(t)),n.reviver?c(t,n.reviver):c(t))})),r(Y,"sync",(function(e,r){var n,t,s,o;if(arguments.length>1){if(!f(r))throw new TypeError(i("invalid argument. Options argument must be an object. Value: `%s`.",r));n=r}else n={};if(n.encoding=null,s=N(e,n),m(s,Error))return s;if(v(s))return s;for(t=new g(s.length),o=0;o<s.length;o++)t[o]=s[o];return t}));var Z=j.rename;function ee(e,r,n){Z(e,r,n)}var re=j.renameSync;function ne(e,r){for(var n=0,t=e.length-1;t>=0;t--){var i=e[t];"."===i?e.splice(t,1):".."===i?(e.splice(t,1),n++):n&&(e.splice(t,1),n--)}if(r)for(;n--;n)e.unshift("..");return e}r(ee,"sync",(function(e,r){try{re(e,r)}catch(e){return e}return null}));var te=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,ie=function(e){return te.exec(e).slice(1)};function se(){for(var e="",r=!1,n=arguments.length-1;n>=-1&&!r;n--){var t=n>=0?arguments[n]:"/";if("string"!=typeof t)throw new TypeError("Arguments to path.resolve must be strings");t&&(e=t+"/"+e,r="/"===t.charAt(0))}return(r?"/":"")+(e=ne(ve(e.split("/"),(function(e){return!!e})),!r).join("/"))||"."}function oe(e){var r=ae(e),n="/"===ge(e,-1);return(e=ne(ve(e.split("/"),(function(e){return!!e})),!r).join("/"))||r||(e="."),e&&n&&(e+="/"),(r?"/":"")+e}function ae(e){return"/"===e.charAt(0)}function ue(){return oe(ve(Array.prototype.slice.call(arguments,0),(function(e,r){if("string"!=typeof e)throw new TypeError("Arguments to path.join must be strings");return e})).join("/"))}function le(e,r){function n(e){for(var r=0;r<e.length&&""===e[r];r++);for(var n=e.length-1;n>=0&&""===e[n];n--);return r>n?[]:e.slice(r,n-r+1)}e=se(e).substr(1),r=se(r).substr(1);for(var t=n(e.split("/")),i=n(r.split("/")),s=Math.min(t.length,i.length),o=s,a=0;a<s;a++)if(t[a]!==i[a]){o=a;break}var u=[];for(a=o;a<t.length;a++)u.push("..");return(u=u.concat(i.slice(o))).join("/")}function fe(e){var r=ie(e),n=r[0],t=r[1];return n||t?(t&&(t=t.substr(0,t.length-1)),n+t):"."}function de(e,r){var n=ie(e)[2];return r&&n.substr(-1*r.length)===r&&(n=n.substr(0,n.length-r.length)),n}function ce(e){return ie(e)[3]}var me={extname:ce,basename:de,dirname:fe,sep:"/",delimiter:":",relative:le,join:ue,isAbsolute:ae,normalize:oe,resolve:se};function ve(e,r){if(e.filter)return e.filter(r);for(var n=[],t=0;t<e.length;t++)r(e[t],t,e)&&n.push(e[t]);return n}var ge="b"==="ab".substr(-1)?function(e,r,n){return e.substr(r,n)}:function(e,r,n){return r<0&&(r=e.length+r),e.substr(r,n)},pe=b(Object.freeze({__proto__:null,basename:de,default:me,delimiter:":",dirname:fe,extname:ce,isAbsolute:ae,join:ue,normalize:oe,relative:le,resolve:se,sep:"/"}));function he(e,r){return f(r)?h(r,"dir")&&(e.dir=r.dir,!l(e.dir))?new TypeError(i("invalid option. `%s` option must be a string. Option: `%s`.","dir",e.dir)):null:new TypeError(i("invalid argument. Options argument must be an object. Value: `%s`.",r))}var ye=pe.resolve;function be(e,r,n){var s,o,a,u,f,d;if(!l(e))throw new TypeError(i("invalid argument. First argument must be a string. Value: `%s`.",e));if(a={},arguments.length>2){if(u=n,d=he(a,r))throw d}else u=r;if(!t(u))throw new TypeError(i("invalid argument. Callback argument must be a function. Value: `%s`.",u));f=a.dir?ye(p(),a.dir):p(),F(s=ye(f,e),(function r(n,t){if(t)return u(null,s);if(o=f,f=ye(f,".."),o===f)return u(null,null);F(s=ye(f,e),r)}))}var je=pe.resolve;function we(e,r){return f(r)?h(r,"dir")&&(e.dir=r.dir,!l(e.dir))?new TypeError(i("invalid option. `%s` option must be a string. Option: `%s`.","dir",e.dir)):null:new TypeError(i("invalid argument. Options argument must be an object. Value: `%s`.",r))}r(be,"sync",(function(e,r){var n,t,s,o,a;if(!l(e))throw new TypeError(i("invalid argument. First argument must be a string. Value: `%s`.",e));if(s={},arguments.length>1&&(a=he(s,r)))throw a;for(o=s.dir?je(p(),s.dir):p();t!==o;){if(_(n=je(o,e)))return n;t=o,o=je(o,"..")}return null}));var Ee=pe.resolve;function Te(e,r,n,s){var o,a,u,f,d,c,m;if(!l(e))throw new TypeError(i("invalid argument. First argument must be a string. Value: `%s`.",e));if(f={},arguments.length>3){if(m=we(f,r))throw m;u=n,d=s}else u=r,d=n;if(!t(u))throw new TypeError(i("invalid argument. Predicate function must be a function. Value: `%s`.",u));if(!t(d))throw new TypeError(i("invalid argument. Callback argument must be a function. Value: `%s`.",d));function v(){if(a=c,c=Ee(c,".."),a===c)return d(null,null);F(o=Ee(c,e),g)}function g(e,r){if(r)return u(o,p);v()}function p(e,r){return e?d(e):r?d(null,o):void v()}c=f.dir?Ee(y(),f.dir):y(),F(o=Ee(c,e),g)}var xe=pe.resolve;r(Te,"sync",(function(e,r,n){var s,o,a,u,f,d;if(!l(e))throw new TypeError(i("invalid argument. First argument must be a string. Value: `%s`.",e));if(u={},arguments.length>2){if(d=we(u,r))throw d;a=n}else a=r;if(!t(a))throw new TypeError(i("invalid argument. Last argument must be a function. Value: `%s`.",a));for(f=u.dir?xe(p(),u.dir):p();o!==f;){if(_(s=xe(f,e))&&a(s))return s;o=f,f=xe(f,"..")}return null}));var Ve=j.unlink;function Fe(e,r){Ve(e,r)}var Se=j.unlinkSync;r(Fe,"sync",(function(e){try{Se(e)}catch(e){return e}return null}));var Oe=j.writeFile;function _e(){var e,r;for(e=[],r=0;r<arguments.length;r++)e.push(arguments[r]);Oe.apply(null,e)}var Pe=j.writeFileSync;r(_e,"sync",(function(e,r,n){try{arguments.length>2?Pe(e,r,n):Pe(e,r)}catch(e){return e}return null}));var ke={};e(ke,"close",E),e(ke,"exists",F),e(ke,"open",M),e(ke,"readDir",C),e(ke,"readFile",B),e(ke,"readFileList",Q),e(ke,"readJSON",X),e(ke,"readWASM",Y),e(ke,"rename",ee),e(ke,"resolveParentPath",be),e(ke,"resolveParentPathBy",Te),e(ke,"unlink",Fe),e(ke,"writeFile",_e);export{E as close,ke as default,F as exists,M as open,C as readDir,B as readFile,Q as readFileList,X as readJSON,Y as readWASM,ee as rename,be as resolveParentPath,Te as resolveParentPathBy,Fe as unlink,_e as writeFile};
//# sourceMappingURL=index.mjs.map
